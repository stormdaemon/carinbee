<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CARinBee - Location de Véhicules</title>
</head>
<body class="home-page">

  <header class="header-custom">
    <div class="container">
      <div class="row align-items-center justify-content-center">
        <div class="col-auto" data-controller="bee-animation" data-bee-animation-type-value="header" data-bee-animation-auto-play-value="true">
          <img src="https://i.postimg.cc/1Xf6vLRL/image-1-removebg-preview-1.png" alt="CARinBee Logo" class="brand-logo" data-bee-animation-target="beeIcon">
        </div>
        <div class="col-auto">
          <span class="brand-name">CARinBee</span>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-12 text-center">
            <p class="header-tagline">La référence de la location de véhicules entre particuliers</p>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col-12 text-center">
            <div class="typed-text-container header-typed-text" data-controller="typed-text">
                <p><span data-typed-text-target="output"></span></p>
            </div>
        </div>
      </div>
    </div>
  </header>

  <main class="main-content">
    <div>
      <div class="row justify-content-center">
        <div class="col-12 text-center intro-text-main">
          <p>Rejoignez la Ruche : Des milliers de voitures prêtes à décoller !</p>
        </div>
      </div>

      <div class="row justify-content-center rejoindre-ruche-button-section">
        <div class="col-auto">
          <%= link_to vehicles_path, class: "no-underline" do %>
            <p class="btn-custom-yellow d-flex align-items-center">Rejoindre la Ruche
              <span>
                <img src="https://i.postimg.cc/1Xf6vLRL/image-1-removebg-preview-1.png" alt="logo" class="bee-pulse">
              </span>
            </p>
          <% end %>
        </div>
      </div>

      <div class="vehicle-cards-section">
        <div class="vehicle-cards-container">
          <%
            target_categories_ordered = ["Confort", "Monospace", "Eco"]
            vehicles_for_carousel_map = {}
            processed_vehicle_ids = []

            if defined?(@featured_vehicles) && @featured_vehicles.present?
              target_categories_ordered.each do |category_name|
                vehicle = @featured_vehicles.find do |v|
                  v.category.to_s.strip.downcase == category_name.downcase &&
                  !processed_vehicle_ids.include?(v.id)
                end
                if vehicle
                  vehicles_for_carousel_map[category_name] = vehicle
                  processed_vehicle_ids << vehicle.id
                end
              end
            end

            final_vehicles_for_carousel = []
            require 'ostruct' unless defined?(OpenStruct)
            require 'securerandom' unless defined?(SecureRandom)

            target_categories_ordered.each do |category_name|
              if vehicles_for_carousel_map.key?(category_name)
                final_vehicles_for_carousel << vehicles_for_carousel_map[category_name]
              else
                placeholder_vehicle = OpenStruct.new(
                  id: SecureRandom.uuid,
                  category: category_name,
                  brand: "{category_name}",
                  model: "#{category_name[0]}-Modèle",
                  image_url: "https://i.postimg.cc/pr3cs33y/Eco-Fiat-500.avif", # Placeholder image
                  price: "#{case category_name; when 'Confort'; '105'; when 'Monospace'; '125'; when 'Eco'; '85'; else '90'; end} €/jour"
                )
                final_vehicles_for_carousel << placeholder_vehicle
              end
            end
            vehicles_for_carousel = final_vehicles_for_carousel.compact.uniq(&:id).first(3)
          %>

          <% if vehicles_for_carousel.any? %>
            <% vehicles_for_carousel.each do |vehicle| %>
              <div class="vehicle-card">
                <div class="vehicle-card-image-wrapper">
                    <img src="<%= cl_image_path vehicle.photo.key, height: 300, crop: :fill %>"
                         class="vehicle-card-image"
                         alt="<%= "#{vehicle.brand} #{vehicle.model}" %>">
                </div>
                <div class="vehicle-card-footer">
                  <h3 class="vehicle-card-category"><%= vehicle.category.presence || "Véhicule" %><span><img src="https://i.postimg.cc/1Xf6vLRL/image-1-removebg-preview-1.png" alt="logo" width="40"></span></h3>
                  <%= link_to "Explorer la catégorie", vehicles_path(category: vehicle.category), class: "vehicle-card-button" %>
                </div>
              </div>
            <% end %>
          <% else %>
            <div class="text-center py-5 col-12">
              <p>Aucun véhicule des catégories Confort, Monospace ou Eco à afficher pour le moment.</p>
            </div>
          <% end %>
        </div>
      </div>

    </div>
  </main>
</body>
</html>
