<!DOCTYPE html>
<html>
  <head>
    <title>CARinBee - Location de voitures entre particuliers</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
    <%= stylesheet_link_tag "https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css", rel: "stylesheet" %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  </head>

  <body>
    <!-- Navbar for all pages except home -->
    <% unless current_page?(root_path) %>
      <%= render 'navbar/navbar' %>
    <% end %>
    
    <%= yield %>
    
    <!-- Flash messages -->
    <% if notice %>
      <div class="alert alert-success alert-dismissible fade show position-fixed" style="top: 20px; right: 20px; z-index: 1050;" role="alert">
        <%= notice %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    <% end %>
    
    <% if alert %>
      <div class="alert alert-danger alert-dismissible fade show position-fixed" style="top: 20px; right: 20px; z-index: 1050;" role="alert">
        <%= alert %>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    <% end %>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    
    <!-- Custom JavaScript for navbar dropdown -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Fonction pour gérer le dropdown de la navbar
        function initializeNavbarDropdown() {
          const dropdownToggle = document.getElementById('navbarDropdown');
          const dropdownMenu = dropdownToggle ? dropdownToggle.nextElementSibling : null;
          
          if (dropdownToggle && dropdownMenu) {
            // Fonction pour positionner le dropdown correctement
            function positionDropdown() {
              const rect = dropdownToggle.getBoundingClientRect();
              const menuWidth = dropdownMenu.offsetWidth;
              const windowWidth = window.innerWidth;
              
              // Vérifier si le dropdown dépasse à droite
              if (rect.right + menuWidth > windowWidth) {
                dropdownMenu.style.right = '0';
                dropdownMenu.style.left = 'auto';
                dropdownMenu.style.transform = 'none';
              }
            }
            
            // Toggle dropdown on click
            dropdownToggle.addEventListener('click', function(e) {
              e.preventDefault();
              e.stopPropagation();
              
              const isOpen = dropdownMenu.classList.contains('show');
              
              // Fermer tous les autres dropdowns
              document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                menu.classList.remove('show');
              });
              
              // Toggle le dropdown actuel
              if (!isOpen) {
                dropdownMenu.classList.add('show');
                // Positionner le dropdown après l'avoir affiché
                setTimeout(positionDropdown, 0);
              }
            });
            
            // Fermer le dropdown quand on clique ailleurs
            document.addEventListener('click', function(e) {
              if (!dropdownToggle.contains(e.target) && !dropdownMenu.contains(e.target)) {
                dropdownMenu.classList.remove('show');
              }
            });
            
            // Fermer le dropdown sur Escape
            document.addEventListener('keydown', function(e) {
              if (e.key === 'Escape') {
                dropdownMenu.classList.remove('show');
              }
            });
            
            // Repositionner le dropdown lors du redimensionnement de la fenêtre
            window.addEventListener('resize', function() {
              if (dropdownMenu.classList.contains('show')) {
                positionDropdown();
              }
            });
          }
          
          // Gérer le menu mobile
          const navbarToggler = document.querySelector('.navbar-toggler');
          const navbarCollapse = document.querySelector('.navbar-collapse');
          
          if (navbarToggler && navbarCollapse) {
            navbarToggler.addEventListener('click', function() {
              navbarCollapse.classList.toggle('show');
            });
          }
        }
        
        // Initialiser au chargement de la page
        initializeNavbarDropdown();
        
        // Réinitialiser après navigation Turbo
        document.addEventListener('turbo:load', initializeNavbarDropdown);
      });
    </script>
  </body>
</html>
