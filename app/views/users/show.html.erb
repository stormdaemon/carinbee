<style>
  /* Animation pour le logo abeille sur la carte */
  #smallBeeLogoOnCard { /* Renommé pour clarté, anciennement smallBeeLogo */
    transition: transform 0.7s ease-in-out, opacity 0.7s ease-in-out;
    pointer-events: none; /* Empêche le logo de bloquer le survol sur les éléments derrière */
  }
  .flying-bee-from-card { /* Renommé pour clarté */
    transform: translate(150px, -150px) rotate(75deg) scale(1.5);
    opacity: 0;
  }

  /* Styles pour le logo abeille sur le bouton "Add Car" */
  #smallBeeOnAddCarButton {
    position: absolute;
    top: -12px; /* Ajustez selon la taille du logo et du bouton */
    right: -12px; /* Ajustez selon la taille du logo et du bouton */
    height: 35px; /* Taille du logo abeille */
    width: auto;
    z-index: 10;
    transition: transform 0.7s ease-in-out, opacity 0.7s ease-in-out;
    pointer-events: none; /* Empêche le logo de bloquer le survol sur le bouton */
  }
  .flying-bee-from-add-car-button {
    transform: translate(150px, -150px) rotate(75deg) scale(1.5); /* Même animation de vol */
    opacity: 0;
  }
</style>

<!-- Yellow Header -->
<div style="background-color: #FFD300; color: #000000; padding: 15px 30px; border-bottom: 3px solid #000000;">
  <div class="d-flex justify-content-between align-items-center">
    <div class="d-flex align-items-center">
      <img src="https://i.postimg.cc/1Xf6vLRL/image-1-removebg-preview-1.png" alt="CARinBee Logo" style="height: 60px; margin-right: 15px;">
      <span style="font-size: 2rem; font-weight: bold;">CARinBee</span>
    </div>
    <div>
      <span style="font-size: 2rem; font-weight: bold;">User profile</span>
    </div>
  </div>
</div>

<!-- Main Content Area -->
<div class="container mt-4 mb-4">
  <div class="card shadow-sm p-4 rounded-3" style="position: relative; background-color: #FFFFFF;">

    <!-- Small Bee Logo (Top Right of White Card) - S'envole au survol du bouton "Edit Profile" -->
    <img id="smallBeeLogoOnCard" src="https://i.postimg.cc/1Xf6vLRL/image-1-removebg-preview-1.png" alt="Small Bee Logo on Card" style="position: absolute; top: 20px; right: 20px; height: 35px; width: auto;">

    <!-- User Information and Edit Button -->
    <div class="d-flex justify-content-between align-items-start mb-4 pt-2">
        <div>
            <h3 class="fw-bold mb-2"><%= @user.first_name %> <%= @user.last_name %></h3>
            <p class="mb-1"><strong>Âge :</strong> <%= @user.age %></p>
            <p class="mb-1"><strong>Adresse :</strong> <%= @user.address %></p>
            <p class="mb-0 text-muted"><%= @user.email %></p>
        </div>
        <% if current_user == @user %>
            <div style="margin-top: 5px;">
                <%= link_to "Edit Profile", edit_user_path(@user), class: "btn btn-outline-primary", id: "editProfileButton" %>
            </div>
        <% end %>
    </div>

    <!-- Véhicules disponibles -->
    <div class="mb-4">
      <h4 class="fw-bold">Mes véhicules disponibles</h4>
      <% if @user_vehicles.any? %>
        <div class="row">
          <% @user_vehicles.each do |vehicle| %>
            <div class="col-md-4 mb-3">
              <div class="card h-100">
                <%= image_tag vehicle.image_url || "https://via.placeholder.com/300x200?text=No+Image", class: "card-img-top", alt: vehicle.model, style: "height: 200px; object-fit: cover;" %>
                <div class="card-body d-flex flex-column">
                  <h5 class="card-title"><%= vehicle.model %></h5>
                  <p class="card-text mb-auto"><%= truncate(vehicle.description, length: 80) %></p>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% else %>
        <p class="text-muted">Aucun véhicule actuellement disponible.</p>
      <% end %>
    </div>

    <!-- "Add Car" Button - Bas à droite de la carte principale -->
    <% if current_user == @user %> <%# S'assurer que seul le propriétaire du profil peut ajouter une voiture %>
      <div class="mt-4 d-flex justify-content-end"> <%# Aligne le bouton à droite %>
        <div style="position: relative;"> <!-- Wrapper pour le bouton et son logo abeille -->
          <%= link_to "Add Car", new_vehicle_path, class: "btn btn-success", id: "addCarButton" %>
          <img id="smallBeeOnAddCarButton"
               src="https://i.postimg.cc/1Xf6vLRL/image-1-removebg-preview-1.png"
               alt="Small Bee on Add Car Button">
        </div>
      </div>
    <% end %>

  </div> <!-- End of card -->
</div>

<!-- JavaScript to trigger animations (adapté pour Turbo) -->
<script>
  function initializeUserProfileAnimations() {
    // Animation pour le logo sur la carte (lié au bouton "Edit Profile")
    const editButton = document.getElementById('editProfileButton');
    const beeLogoOnCard = document.getElementById('smallBeeLogoOnCard'); // ID mis à jour

    if (editButton && beeLogoOnCard) {
      beeLogoOnCard.classList.remove('flying-bee-from-card'); // Réinitialisation pour Turbo
      let isHoveringEdit = false;
      let hasFlownEdit = false;

      editButton.addEventListener('mouseover', function() {
        if (!isHoveringEdit) {
            isHoveringEdit = true;
            hasFlownEdit = false;
        }
        if (!hasFlownEdit) {
            beeLogoOnCard.classList.add('flying-bee-from-card');
            hasFlownEdit = true;
        }
      });
      editButton.addEventListener('mouseout', function() {
          isHoveringEdit = false;
          // Optionnel: beeLogoOnCard.classList.remove('flying-bee-from-card');
      });
    }

    // Animation pour le logo sur le bouton "Add Car"
    const addCarButton = document.getElementById('addCarButton');
    const beeLogoOnAddCarBtn = document.getElementById('smallBeeOnAddCarButton');

    if (addCarButton && beeLogoOnAddCarBtn) {
      beeLogoOnAddCarBtn.classList.remove('flying-bee-from-add-car-button'); // Réinitialisation pour Turbo
      let isHoveringAddCar = false;
      let hasFlownAddCar = false;

      addCarButton.addEventListener('mouseover', function() {
        if(!isHoveringAddCar) {
            isHoveringAddCar = true;
            hasFlownAddCar = false;
        }
        if(!hasFlownAddCar) {
            beeLogoOnAddCarBtn.classList.add('flying-bee-from-add-car-button');
            hasFlownAddCar = true;
        }
      });
      addCarButton.addEventListener('mouseout', function() {
          isHoveringAddCar = false;
          // Optionnel: beeLogoOnAddCarBtn.classList.remove('flying-bee-from-add-car-button');
      });
    }
  }

  // Écouter turbo:load pour initialiser les animations
  document.addEventListener('turbo:load', initializeUserProfileAnimations);
</script>
