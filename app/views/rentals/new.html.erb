<%# app/views/rentals/new.html.erb %>

<div class="container mt-4 mb-4 rental-container">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">üöó Nouvelle demande de location</h2>
        <%= link_to "‚Üê Retour", vehicle_path(@vehicle), class: "btn btn-outline-secondary" %>
      </div>

      <div class="row">
        <div class="col-lg-7">
          <div class="card shadow-sm p-4 rounded-3 rental-card" style="background-color: #FFFFFF;" data-controller="bee-animation rental-form" data-bee-animation-type-value="update" data-rental-form-daily-price-value="<%= @vehicle.daily_price %>">

            <img id="smallBeeLogoOnCard" src="https://i.postimg.cc/1Xf6vLRL/image-1-removebg-preview-1.png" alt="Small Bee Logo on Card" class="bee-pulse" style="position: absolute; top: 20px; right: 20px; height: 35px; width: auto;" data-bee-animation-target="beeIcon">

            <h4 class="fw-bold mb-4 pt-2">üìù Informations de r√©servation</h4>

            <%= form_with(model: [@vehicle, @rental], local: true, html: { class: "needs-validation", novalidate: true, data: { rental_form_target: "form" } }) do |form| %>

              <% if @rental.errors.any? %>
                <div class="alert alert-danger mb-4">
                  <h6 class="fw-bold mb-2">‚ö†Ô∏è Erreurs d√©tect√©es :</h6>
                  <ul class="mb-0">
                    <% @rental.errors.full_messages.each do |message| %>
                      <li><%= message %></li>
                    <% end %>
                  </ul>
                </div>
              <% end %>

              <div class="date-input-group">
                <div class="form-floating">
                  <%= form.date_field :rental_start_date,
                      class: "form-control #{'is-invalid' if @rental.errors[:rental_start_date].any?}",
                      id: "rental_start_date",
                      min: Date.current,
                      required: true,
                      data: { rental_form_target: "startDate" } %>
                  <%= form.label :rental_start_date, "üìÖ Date de d√©but", class: "form-label" %>
                  <% if @rental.errors[:rental_start_date].any? %>
                    <div class="invalid-feedback">
                      <%= @rental.errors[:rental_start_date].first %>
                    </div>
                  <% end %>
                </div>
              </div>

              <div class="date-input-group">
                <div class="form-floating">
                  <%= form.date_field :rental_end_date,
                      class: "form-control #{'is-invalid' if @rental.errors[:rental_end_date].any?}",
                      id: "rental_end_date",
                      min: Date.current + 1.day,
                      required: true,
                      data: { rental_form_target: "endDate" } %>
                  <%= form.label :rental_end_date, "üìÖ Date de fin", class: "form-label" %>
                  <% if @rental.errors[:rental_end_date].any? %>
                    <div class="invalid-feedback">
                      <%= @rental.errors[:rental_end_date].first %>
                    </div>
                  <% end %>
                </div>
              </div>

              <div class="form-floating">
                <%= form.text_area :message,
                    class: "form-control #{'is-invalid' if @rental.errors[:message].any?}",
                    id: "rental_message",
                    style: "height: 120px;",
                    placeholder: "D√©crivez votre demande..." %>
                <%= form.label :rental_message, "üí¨ Message au propri√©taire (optionnel)", class: "form-label" %>
                <% if @rental.errors[:message].any? %>
                  <div class="invalid-feedback">
                    <%= @rental.errors[:message].first %>
                  </div>
                <% end %>
              </div>

              <div class="d-flex gap-3 mt-4">
                <div data-controller="bee-animation" data-bee-animation-type-value="update">
                  <%= form.submit "üöÄ Envoyer la demande", class: "btn btn-success flex-fill action-button", id: "submitButton", data: { bee_animation_target: "button" } %>
                  <img id="beeOnSubmit" src="https://i.postimg.cc/1Xf6vLRL/image-1-removebg-preview-1.png" alt="Bee on Submit" class="small-bee-on-button bee-pulse" data-bee-animation-target="beeIcon">
                </div>
                <div data-controller="bee-animation" data-bee-animation-type-value="update">
                  <%= link_to "‚ùå Annuler", vehicle_path(@vehicle), class: "btn btn-outline-secondary flex-fill action-button", id: "cancelButton", data: { bee_animation_target: "button" } %>
                  <img id="beeOnCancel" src="https://i.postimg.cc/1Xf6vLRL/image-1-removebg-preview-1.png" alt="Bee on Cancel" class="small-bee-on-button bee-pulse" data-bee-animation-target="beeIcon">
                </div>
              </div>
            <% end %>
          </div>
        </div>

        <div class="col-lg-5">
          <div class="card shadow-sm p-4 rounded-3" style="background-color: #FFFFFF;">
            <h4 class="fw-bold mb-4">üöó V√©hicule s√©lectionn√©</h4>

            <% if @vehicle.photo.attached? %>
              <%= image_tag @vehicle.photo, alt: @vehicle.brand + " " + @vehicle.model, class: "img-fluid vehicle-image w-100 mb-3" %>
            <% else %>
              <div class="vehicle-image-placeholder bg-light d-flex align-items-center justify-content-center mb-3" style="height: 200px; border-radius: 10px;">
                <i class="fas fa-car fa-3x text-muted"></i>
              </div>
            <% end %>

            <h5 class="fw-bold mb-2"><%= @vehicle.brand %> <%= @vehicle.model %></h5>
            <p class="text-muted mb-2">üìç <%= @vehicle.address %></p>
            <p class="text-success fw-bold fs-5 mb-3">üí∞ <%= number_to_currency(@vehicle.daily_price, unit: "‚Ç¨") %>/jour</p>

            <% if @vehicle.description.present? %>
              <hr class="my-3">
              <small class="text-muted">üìù Description</small>
              <p class="mb-0 small"><%= truncate(@vehicle.description, length: 150) %></p>
            <% end %>
          </div>

          <div class="booking-summary" id="bookingSummary" style="display: none;" data-rental-form-target="summary">
            <h5 class="fw-bold mb-3">üìä R√©sum√© de votre r√©servation</h5>

            <div class="mb-3">
              <div class="d-flex justify-content-between mb-2">
                <span>üìÖ Du :</span>
                <span data-rental-form-target="summaryStartDate" class="fw-semibold">-</span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>üìÖ Au :</span>
                <span data-rental-form-target="summaryEndDate" class="fw-semibold">-</span>
              </div>
              <div class="d-flex justify-content-between mb-3">
                <span>‚è±Ô∏è Dur√©e :</span>
                <span data-rental-form-target="summaryDuration" class="fw-semibold">-</span>
              </div>
            </div>

            <hr class="my-3">

            <div class="price-calculation">
              <div class="d-flex justify-content-between mb-2">
                <span>üí∞ Prix par jour :</span>
                <span><%= number_to_currency(@vehicle.daily_price, unit: "‚Ç¨") %></span>
              </div>
              <div class="d-flex justify-content-between mb-2">
                <span>üìä Nombre de jours :</span>
                <span data-rental-form-target="summaryDays">-</span>
              </div>
              <hr class="my-2">
              <div class="d-flex justify-content-between">
                <span class="fw-bold fs-5">üí≥ Total :</span>
                <span data-rental-form-target="summaryTotal" class="fw-bold fs-4 text-success">-</span>
              </div>
            </div>

            <div class="alert alert-info mt-3 mb-0">
              <small>‚ÑπÔ∏è Le prix final sera confirm√© par le propri√©taire lors de l'acceptation de votre demande.</small>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
